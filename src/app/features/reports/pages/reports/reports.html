<div class="reports-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>ğŸ“Š RelatÃ³rios Automatizados</h1>
      <p class="subtitle">Agende e gere relatÃ³rios personalizados</p>
    </div>
    <div class="header-actions">
      <app-theme-language-toggle></app-theme-language-toggle>
      <button class="btn-primary" (click)="openCreateModal()">
        <span>â•</span> Novo RelatÃ³rio
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'scheduled'"
      (click)="activeTab = 'scheduled'">
      ğŸ—“ï¸ Agendados
      <span class="badge">{{ scheduledReports.length }}</span>
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'generated'"
      (click)="activeTab = 'generated'">
      ğŸ“„ Gerados
      <span class="badge">{{ generatedReports.length }}</span>
    </button>
  </div>

  <!-- Scheduled Reports -->
  <div class="content-area" *ngIf="activeTab === 'scheduled'">
    <div class="reports-grid" *ngIf="scheduledReports.length > 0">
      <div class="report-card" *ngFor="let report of scheduledReports">
        <div class="report-header">
          <div class="report-icon">{{ getReportTypeInfo(report.type).icon }}</div>
          <div class="status-badge" [style.background]="getStatusColor(report.active)">
            {{ getStatusLabel(report.active) }}
          </div>
        </div>
        
        <h3 class="report-name">{{ report.name }}</h3>
        <p class="report-type">{{ getReportTypeInfo(report.type).label }}</p>
        
        <div class="report-details">
          <div class="detail-row">
            <span class="icon">ğŸ”„</span>
            <div>
              <span class="label">Tipo:</span>
              <span class="value">{{ getFrequencyInfo(report.type).label }}</span>
            </div>
          </div>
          
          <div class="detail-row">
            <span class="icon">ğŸ“…</span>
            <div>
              <span class="label">PrÃ³xima execuÃ§Ã£o:</span>
              <span class="value">{{ getNextRunDate(report) }}</span>
            </div>
          </div>
          
          <div class="detail-row">
            <span class="icon">ğŸ“‹</span>
            <div>
              <span class="label">Formato:</span>
              <span class="value">{{ getFormatInfo(report.format).label }}</span>
            </div>
          </div>
          
          <div class="detail-row" *ngIf="report.recipients && report.recipients.length > 0">
            <span class="icon">ğŸ“§</span>
            <div>
              <span class="label">DestinatÃ¡rios:</span>
              <span class="value">{{ report.recipients.length }} email(s)</span>
            </div>
          </div>
        </div>
        
        <div class="report-actions">
          <button class="btn-icon" (click)="generateNow(report)" title="Gerar agora">
            â–¶ï¸
          </button>
          <button class="btn-icon" (click)="pauseReport(report)" title="Pausar/Ativar">
            {{ report.active ? 'â¸ï¸' : 'â–¶ï¸' }}
          </button>
          <button class="btn-icon danger" (click)="deleteReport(report)" title="Excluir">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    </div>
    
    <div class="empty-state" *ngIf="scheduledReports.length === 0">
      <span class="empty-icon">ğŸ—“ï¸</span>
      <h3>Nenhum relatÃ³rio agendado</h3>
      <p>Crie relatÃ³rios automÃ¡ticos para acompanhar mÃ©tricas importantes</p>
      <button class="btn-primary" (click)="openCreateModal()">
        â• Criar Primeiro RelatÃ³rio
      </button>
    </div>
  </div>

  <!-- Generated Reports -->
  <div class="content-area" *ngIf="activeTab === 'generated'">
    <div class="generated-list" *ngIf="generatedReports.length > 0">
      <div class="generated-card" *ngFor="let report of generatedReports">
        <div class="generated-header">
          <div class="report-info">
            <span class="report-icon">{{ getReportTypeInfo(report.type).icon }}</span>
            <div>
              <h3>{{ report.name }}</h3>
              <p class="report-meta">
                {{ getReportTypeInfo(report.type).label }} â€¢ 
                {{ getFormatInfo(report.format).label }} â€¢
                {{ report.generatedAt | date: 'dd/MM/yyyy HH:mm' }}
              </p>
            </div>
          </div>
          
          <div class="status-badge completed">
            âœ… Gerado
          </div>
        </div>
        
        <div class="generated-details">
          <div class="detail-item">
            <span class="icon">ğŸ“</span>
            <div>
              <strong>Tamanho:</strong>
              <p>{{ getFileSize(report.fileSize) }}</p>
            </div>
          </div>
          
          <div class="detail-item" *ngIf="report.recordsCount">
            <span class="icon">ğŸ“Š</span>
            <div>
              <strong>Registros:</strong>
              <p>{{ report.recordsCount }}</p>
            </div>
          </div>
          
          <div class="detail-item" *ngIf="report.sentAt">
            <span class="icon">ğŸ“§</span>
            <div>
              <strong>Enviado em:</strong>
              <p>{{ report.sentAt | date: 'dd/MM/yyyy HH:mm' }}</p>
            </div>
          </div>
        </div>
        
        <div class="generated-actions">
          <button class="btn-download" (click)="downloadReport(report)">
            ğŸ“¥ Download
          </button>
          <button class="btn-send" (click)="sendReport(report)">
            ğŸ“§ Enviar Email
          </button>
        </div>
      </div>
    </div>
    
    <div class="empty-state" *ngIf="generatedReports.length === 0">
      <span class="empty-icon">ğŸ“„</span>
      <h3>Nenhum relatÃ³rio gerado</h3>
      <p>RelatÃ³rios gerados aparecerÃ£o aqui</p>
    </div>
  </div>
</div>

<!-- Create Report Modal -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>â• Criar Novo RelatÃ³rio</h2>
      <button class="close-btn" (click)="closeCreateModal()">âœ•</button>
    </div>
    
    <div class="modal-body">
      <!-- Report Name -->
      <div class="form-group">
        <label>Nome do RelatÃ³rio *</label>
        <input 
          type="text" 
          [(ngModel)]="newReport.name" 
          placeholder="Ex: RelatÃ³rio Semanal de DoaÃ§Ãµes"
          class="form-input">
      </div>
      
      <!-- Report Type -->
      <div class="form-group">
        <label>Tipo de RelatÃ³rio *</label>
        <div class="type-grid">
          <div 
            class="type-card" 
            *ngFor="let type of reportTypes"
            [class.selected]="newReport.type === type.value"
            (click)="setReportType(type.value)">
            <span class="type-icon">{{ type.icon }}</span>
            <h4>{{ type.label }}</h4>
            <p>{{ type.description }}</p>
          </div>
        </div>
      </div>
      
      <!-- Frequency and Format -->
      <div class="form-row">
        <div class="form-group">
          <label>Tipo *</label>
          <select [(ngModel)]="newReport.type" class="form-select">
            <option *ngFor="let freq of frequencies" [value]="freq.value">
              {{ freq.icon }} {{ freq.label }}
            </option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Formato *</label>
          <select [(ngModel)]="newReport.format" class="form-select">
            <option *ngFor="let fmt of formats" [value]="fmt.value">
              {{ fmt.icon }} {{ fmt.label }} - {{ fmt.description }}
            </option>
          </select>
        </div>
      </div>
      
      <!-- Sections to Include -->
      <div class="form-group">
        <label>Incluir nos RelatÃ³rios</label>
        <div class="checkboxes">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="newReport.includeMetrics">
            <span>ï¿½ MÃ©tricas Gerais</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="newReport.includeCampaigns">
            <span>ï¿½ Campanhas</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="newReport.includeVolunteers">
            <span>ğŸ¤ VoluntÃ¡rios</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="newReport.includeDonations">
            <span>ï¿½ DoaÃ§Ãµes</span>
          </label>
        </div>
      </div>
      
      <!-- Recipients -->
      <div class="form-group">
        <label>DestinatÃ¡rios (Email)</label>
        <div class="recipients-input">
          <input 
            type="email" 
            [(ngModel)]="newRecipient" 
            placeholder="email@exemplo.com"
            class="form-input"
            (keyup.enter)="addRecipient()">
          <button class="btn-add" (click)="addRecipient()">â•</button>
        </div>
        
        <div class="recipients-list" *ngIf="newReport.recipients && newReport.recipients.length > 0">
          <div class="recipient-tag" *ngFor="let email of newReport.recipients">
            <span>ğŸ“§ {{ email }}</span>
            <button class="remove-btn" (click)="removeRecipient(email)">âœ•</button>
          </div>
        </div>
      </div>
      
      <div class="info-box">
        <span class="icon">ğŸ’¡</span>
        <p>O relatÃ³rio serÃ¡ gerado automaticamente na frequÃªncia selecionada e enviado para os destinatÃ¡rios.</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeCreateModal()">Cancelar</button>
      <button class="btn-primary" (click)="scheduleReport()">
        ğŸ—“ï¸ Agendar RelatÃ³rio
      </button>
    </div>
  </div>
</div>
