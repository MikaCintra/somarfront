<div class="analytics-container">
  <!-- Header -->
  <div class="analytics-header">
    <div class="header-content">
      <h1>ğŸ“Š Dashboard Analytics</h1>
      <p>Acompanhe mÃ©tricas e resultados em tempo real</p>
    </div>
    <div class="header-actions">
      <app-theme-language-toggle></app-theme-language-toggle>
      <div class="period-selector">
        <button 
          [class.active]="selectedPeriod === 7" 
          (click)="changePeriod(7)"
          class="period-btn"
        >
          7 dias
        </button>
        <button 
          [class.active]="selectedPeriod === 30" 
          (click)="changePeriod(30)"
          class="period-btn"
        >
          30 dias
        </button>
        <button 
          [class.active]="selectedPeriod === 90" 
          (click)="changePeriod(90)"
          class="period-btn"
        >
          90 dias
        </button>
      </div>
      <button class="btn-export" (click)="downloadReport()">
        ğŸ“¥ Exportar CSV
      </button>
    </div>
  </div>

  <div class="analytics-content" *ngIf="metrics">
    <!-- MÃ©tricas Gerais -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-icon donations">ğŸ’</div>
        <div class="metric-data">
          <h3>{{ metrics.totalDonations }}</h3>
          <p>Total de DoaÃ§Ãµes</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon donors">ğŸ‘¥</div>
        <div class="metric-data">
          <h3>{{ metrics.totalDonors }}</h3>
          <p>Doadores Ãšnicos</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon items">ğŸ“¦</div>
        <div class="metric-data">
          <h3>{{ metrics.totalItems }}</h3>
          <p>Itens Arrecadados</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon campaigns">ğŸ¯</div>
        <div class="metric-data">
          <h3>{{ metrics.activeCampaigns }}/{{ metrics.totalCampaigns }}</h3>
          <p>Campanhas Ativas</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon volunteers">ğŸ¤</div>
        <div class="metric-data">
          <h3>{{ metrics.totalVolunteers }}</h3>
          <p>VoluntÃ¡rios Inscritos</p>
        </div>
      </div>

      <div class="metric-card highlight">
        <div class="metric-icon impact" [class]="getImpactLevel()">â­</div>
        <div class="metric-data">
          <h3>{{ metrics.impactScore }}/100</h3>
          <p>Score de Impacto</p>
          <span class="impact-badge" [class]="getImpactLevel()">
            {{ getImpactLevel() | uppercase }}
          </span>
        </div>
      </div>

      <div class="metric-card highlight">
        <div class="metric-icon growth" [class]="getGrowthClass()">ğŸ“ˆ</div>
        <div class="metric-data">
          <h3 [class]="getGrowthClass()">
            {{ metrics.growthRate > 0 ? '+' : '' }}{{ metrics.growthRate }}%
          </h3>
          <p>Taxa de Crescimento</p>
          <span class="growth-label">Ãšltimos {{ selectedPeriod }} dias</span>
        </div>
      </div>
    </div>

    <!-- GrÃ¡ficos e AnÃ¡lises -->
    <div class="charts-section">
      <!-- GrÃ¡fico de DoaÃ§Ãµes ao Longo do Tempo -->
      <div class="chart-card">
        <div class="chart-header">
          <h2>ğŸ“ˆ DoaÃ§Ãµes ao Longo do Tempo</h2>
          <span class="chart-legend">
            <span class="legend-item donations">â— DoaÃ§Ãµes</span>
            <span class="legend-item volunteers">â— VoluntÃ¡rios</span>
          </span>
        </div>
        <div class="chart-container">
          <div class="chart-bars">
            <div class="bar-group" *ngFor="let data of timeSeriesData">
              <div class="bar-wrapper">
                <div 
                  class="bar donations" 
                  [style.height.%]="getBarHeight(data.donations, maxDonationsInPeriod)"
                  [title]="data.donations + ' doaÃ§Ãµes'"
                ></div>
                <div 
                  class="bar volunteers" 
                  [style.height.%]="getBarHeight(data.volunteers, maxVolunteersInPeriod)"
                  [title]="data.volunteers + ' voluntÃ¡rios'"
                ></div>
              </div>
              <span class="bar-label">{{ formatDate(data.date) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- DistribuiÃ§Ã£o por Categoria -->
      <div class="chart-card">
        <div class="chart-header">
          <h2>ğŸ¯ DistribuiÃ§Ã£o por Categoria</h2>
        </div>
        <div class="category-stats">
          <div class="category-item" *ngFor="let cat of categoryMetrics">
            <div class="category-info">
              <span class="category-name">{{ cat.category }}</span>
              <span class="category-count">{{ cat.count }} doaÃ§Ãµes ({{ cat.items }} itens)</span>
            </div>
            <div class="category-bar-container">
              <div class="category-bar" [style.width.%]="cat.percentage"></div>
              <span class="category-percentage">{{ cat.percentage }}%</span>
            </div>
          </div>
          
          <div class="empty-state" *ngIf="categoryMetrics.length === 0">
            <p>ğŸ“Š Nenhuma doaÃ§Ã£o registrada ainda</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance das Campanhas -->
    <div class="performance-section">
      <div class="section-header">
        <h2>ğŸ¯ Performance das Campanhas</h2>
      </div>
      <div class="performance-list">
        <div 
          class="performance-item" 
          *ngFor="let campaign of campaignPerformance"
          [class]="'status-' + campaign.status"
        >
          <div class="campaign-info">
            <h4>{{ campaign.title }}</h4>
            <p>{{ campaign.donationsCount }} doaÃ§Ãµes</p>
          </div>
          <div class="campaign-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="campaign.progress"></div>
            </div>
            <span class="progress-text">{{ campaign.progress }}%</span>
          </div>
          <span class="status-badge" [class]="campaign.status">
            {{ getStatusLabel(campaign.status) }}
          </span>
        </div>

        <div class="empty-state" *ngIf="campaignPerformance.length === 0">
          <p>ğŸ¯ Nenhuma campanha encontrada</p>
        </div>
      </div>
    </div>

    <!-- Top Doadores -->
    <div class="top-donors-section">
      <div class="section-header">
        <h2>ğŸ† Top Doadores</h2>
      </div>
      <div class="donors-grid">
        <div class="donor-card" *ngFor="let donor of topDonors; let i = index">
          <div class="donor-rank" [class]="'rank-' + (i + 1)">
            <span *ngIf="i === 0">ğŸ¥‡</span>
            <span *ngIf="i === 1">ğŸ¥ˆ</span>
            <span *ngIf="i === 2">ğŸ¥‰</span>
            <span *ngIf="i > 2">#{{ i + 1 }}</span>
          </div>
          <div class="donor-avatar">
            {{ getDonorInitials(donor.name) }}
          </div>
          <div class="donor-info">
            <h4>{{ donor.name }}</h4>
            <p class="donor-email">{{ donor.email }}</p>
            <div class="donor-stats">
              <span class="stat">
                <strong>{{ donor.totalDonations }}</strong> doaÃ§Ãµes
              </span>
              <span class="stat">
                <strong>{{ donor.totalItems }}</strong> itens
              </span>
            </div>
          </div>
        </div>

        <div class="empty-state" *ngIf="topDonors.length === 0">
          <p>ğŸ† Nenhum doador encontrado</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="!metrics">
    <div class="spinner"></div>
    <p>Carregando analytics...</p>
  </div>
</div>
