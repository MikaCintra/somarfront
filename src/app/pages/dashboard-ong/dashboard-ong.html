<div class="dashboard-content">
  <!-- Header -->
  <header class="dashboard-header">
    <div>
      <h1>Bem-vinda, {{ currentUserName }}! üëã</h1>
      <p>Gerencie suas campanhas e acompanhe o impacto social</p>
    </div>
    <div class="header-actions">
        <app-theme-language-toggle></app-theme-language-toggle>
        <button class="btn-primary" (click)="openNewCampaignModal()">+ Nova Campanha</button>
      </div>
    </header>

    <!-- Stats Cards -->
    <section class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon green">üì¢</div>
        <div class="stat-info">
          <h3>Campanhas Ativas</h3>
          <p class="stat-value">{{ campaigns.length }}</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon blue">ü§ù</div>
        <div class="stat-info">
          <h3>Doadores Ativos</h3>
          <p class="stat-value">{{ donorsStats.active }}</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon orange">üíù</div>
        <div class="stat-info">
          <h3>Total de Doa√ß√µes</h3>
          <p class="stat-value">{{ donorsStats.totalDonations }}</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon purple">üìà</div>
        <div class="stat-info">
          <h3>Horas Volunt√°rias</h3>
          <p class="stat-value">{{ donorsStats.totalVolunteerHours }}h</p>
        </div>
      </div>
    </section>

    <!-- Campaigns Section -->
    <section class="section">
      <h2>Campanhas em Andamento</h2>
      <div class="campaigns-grid">
        <div class="campaign-card" *ngFor="let campaign of campaigns">
          <div class="campaign-header">
            <h3>{{ campaign.title }}</h3>
            <span class="badge">{{ campaign.category }}</span>
          </div>
          <p class="campaign-description">{{ campaign.description }}</p>
          <div class="campaign-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getProgress(campaign)"></div>
            </div>
            <div class="progress-info">
              <span>{{ campaign.current }} / {{ campaign.goal }} itens</span>
              <span class="progress-percent">{{ getProgress(campaign) | number:'1.0-0' }}%</span>
            </div>
          </div>
          <div class="campaign-actions">
            <button class="btn-text" (click)="openEditCampaignModal(campaign)">‚úèÔ∏è Editar</button>
            <button class="btn-text btn-danger" (click)="deleteCampaign(campaign.id)">üóëÔ∏è Excluir</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Volunteers Section -->
    <section class="section">
      <div class="section-header">
        <h2>Oportunidades de Voluntariado</h2>
        <button class="btn-primary" (click)="openNewVolunteerModal()">‚ûï Nova Oportunidade</button>
      </div>

      <div class="opportunities-grid" *ngIf="opportunities.length > 0">
        <div class="opportunity-card" *ngFor="let opp of opportunities">
          <div class="opportunity-header">
            <h3>{{ opp.title }}</h3>
            <span class="vacancy-badge" [ngClass]="getVacancyClass(opp)">
              {{ getVacancyStatus(opp) }}
            </span>
          </div>
          
          <p class="opportunity-description">{{ opp.description }}</p>
          
          <div class="opportunity-details">
            <div class="detail-item">
              <span class="detail-icon">üìÖ</span>
              <span>{{ opp.date | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">‚è∞</span>
              <span>{{ opp.time }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">üìç</span>
              <span>{{ opp.location }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">üë•</span>
              <span>{{ opp.currentVolunteers }} / {{ opp.vacancies }} inscritos</span>
            </div>
          </div>

          <div class="skills-tags" *ngIf="opp.skills && opp.skills.length > 0">
            <span class="skill-tag" *ngFor="let skill of opp.skills">{{ skill }}</span>
          </div>

          <div class="opportunity-actions">
            <button class="btn-text" (click)="viewRegistrations(opp)">
              üëÅÔ∏è Ver Inscritos ({{ opp.currentVolunteers }})
            </button>
            <button class="btn-text" (click)="openEditVolunteerModal(opp)">‚úèÔ∏è Editar</button>
            <button class="btn-text btn-danger" (click)="deleteVolunteerOpportunity(opp.id)">üóëÔ∏è Excluir</button>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="opportunities.length === 0">
        <p>üåü Nenhuma oportunidade de voluntariado criada ainda.</p>
        <p>Clique em "Nova Oportunidade" para come√ßar!</p>
      </div>
    </section>

    <!-- Top Donors Section -->
    <section class="section">
      <div class="section-header">
        <h2>üèÜ Top Doadores</h2>
        <p class="section-subtitle">Os doadores mais engajados da plataforma</p>
      </div>

      <div class="donors-table">
        <table>
          <thead>
            <tr>
              <th>Posi√ß√£o</th>
              <th>Doador</th>
              <th>Localiza√ß√£o</th>
              <th>Doa√ß√µes</th>
              <th>Horas Volunt√°rias</th>
              <th>N√≠vel</th>
              <th>√öltima Atividade</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let donor of donors.slice(0, 10); let i = index" class="donor-row">
              <td class="rank-cell">
                <span class="rank-badge" [ngClass]="i < 3 ? 'rank-top' : ''">
                  {{ i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '#' + (i + 1) }}
                </span>
              </td>
              <td class="donor-cell">
                <div class="donor-info">
                  <img [src]="donor.avatarUrl" [alt]="donor.name" class="donor-avatar" />
                  <div>
                    <strong>{{ donor.name }}</strong>
                    <small>{{ donor.email }}</small>
                  </div>
                </div>
              </td>
              <td>{{ donor.address?.city }}, {{ donor.address?.state }}</td>
              <td class="donations-cell">
                <strong>{{ donor.totalDonations }}</strong>
                <small>doa√ß√µes</small>
              </td>
              <td class="hours-cell">
                <strong>{{ donor.totalVolunteerHours }}h</strong>
              </td>
              <td>
                <span class="level-badge" [ngClass]="'level-' + (donor.level <= 5 ? 'low' : donor.level <= 10 ? 'medium' : 'high')">
                  N√≠vel {{ donor.level }}
                </span>
              </td>
              <td class="activity-cell">
                <small>{{ donor.lastLogin | date:'dd/MM/yyyy' }}</small>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="donors-stats-summary">
        <div class="stat-summary-card">
          <span class="stat-icon">üë•</span>
          <div>
            <strong>{{ donorsStats.total }}</strong>
            <small>Total de Doadores</small>
          </div>
        </div>
        <div class="stat-summary-card">
          <span class="stat-icon">üìä</span>
          <div>
            <strong>{{ donorsStats.averageDonationsPerDonor }}</strong>
            <small>M√©dia de Doa√ß√µes/Doador</small>
          </div>
        </div>
        <div class="stat-summary-card">
          <span class="stat-icon">‚è±Ô∏è</span>
          <div>
            <strong>{{ donorsStats.averageVolunteerHoursPerDonor }}h</strong>
            <small>M√©dia de Horas/Doador</small>
          </div>
        </div>
        <div class="stat-summary-card">
          <span class="stat-icon">‚≠ê</span>
          <div>
            <strong>{{ donorsStats.topDonor.name }}</strong>
            <small>Top Doador ({{ donorsStats.topDonor.totalDonations }} doa√ß√µes)</small>
          </div>
        </div>
      </div>
    </section>

<!-- Modal de Cria√ß√£o/Edi√ß√£o de Campanha -->
<app-modal 
  [isOpen]="isModalOpen" 
  [title]="editingCampaign ? 'Editar Campanha' : 'Nova Campanha'"
  size="medium"
  (close)="closeModal()">
  
  <form [formGroup]="campaignForm" (ngSubmit)="saveCampaign()">
    <div class="form-group">
      <label for="title">T√≠tulo da Campanha *</label>
      <input 
        type="text" 
        id="title" 
        formControlName="title"
        placeholder="Ex: Campanha do Agasalho 2025"
        class="form-input"
      />
      <span class="error-message" *ngIf="campaignForm.get('title')?.invalid && campaignForm.get('title')?.touched">
        T√≠tulo deve ter no m√≠nimo 5 caracteres
      </span>
    </div>

    <div class="form-group">
      <label for="description">Descri√ß√£o *</label>
      <textarea 
        id="description" 
        formControlName="description"
        rows="4"
        placeholder="Descreva os objetivos e detalhes da campanha..."
        class="form-input"
      ></textarea>
      <span class="error-message" *ngIf="campaignForm.get('description')?.invalid && campaignForm.get('description')?.touched">
        Descri√ß√£o deve ter no m√≠nimo 10 caracteres
      </span>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="goal">Meta (quantidade de itens) *</label>
        <input 
          type="number" 
          id="goal" 
          formControlName="goal"
          min="1"
          class="form-input"
        />
        <span class="error-message" *ngIf="campaignForm.get('goal')?.invalid && campaignForm.get('goal')?.touched">
          Meta deve ser maior que 0
        </span>
      </div>

      <div class="form-group">
        <label for="category">Categoria *</label>
        <select 
          id="category" 
          formControlName="category"
          class="form-input"
        >
          <option value="">Selecione uma categoria</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
        <span class="error-message" *ngIf="campaignForm.get('category')?.invalid && campaignForm.get('category')?.touched">
          Selecione uma categoria
        </span>
      </div>
    </div>

    <div class="form-group">
      <label for="location">Localiza√ß√£o *</label>
      <input 
        type="text" 
        id="location" 
        formControlName="location"
        placeholder="Ex: S√£o Paulo, SP"
        class="form-input"
      />
      <span class="error-message" *ngIf="campaignForm.get('location')?.invalid && campaignForm.get('location')?.touched">
        Localiza√ß√£o √© obrigat√≥ria
      </span>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" (click)="closeModal()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="campaignForm.invalid">
        {{ editingCampaign ? 'Salvar Altera√ß√µes' : 'Criar Campanha' }}
      </button>
    </div>
  </form>
</app-modal>

<!-- Modal de Cria√ß√£o/Edi√ß√£o de Oportunidade de Voluntariado -->
<app-modal 
  [isOpen]="isVolunteerModalOpen" 
  [title]="editingOpportunity ? 'Editar Oportunidade' : 'Nova Oportunidade de Voluntariado'"
  size="large"
  (close)="closeVolunteerModal()">
  
  <form [formGroup]="volunteerForm" (ngSubmit)="saveVolunteerOpportunity()">
    <div class="form-group">
      <label for="vol-title">T√≠tulo da Oportunidade *</label>
      <input 
        type="text" 
        id="vol-title" 
        formControlName="title"
        placeholder="Ex: Distribui√ß√£o de Alimentos"
        class="form-input"
      />
      <span class="error-message" *ngIf="volunteerForm.get('title')?.invalid && volunteerForm.get('title')?.touched">
        T√≠tulo deve ter no m√≠nimo 5 caracteres
      </span>
    </div>

    <div class="form-group">
      <label for="vol-description">Descri√ß√£o *</label>
      <textarea 
        id="vol-description" 
        formControlName="description"
        rows="3"
        placeholder="Descreva as atividades que o volunt√°rio ir√° realizar..."
        class="form-input"
      ></textarea>
      <span class="error-message" *ngIf="volunteerForm.get('description')?.invalid && volunteerForm.get('description')?.touched">
        Descri√ß√£o deve ter no m√≠nimo 10 caracteres
      </span>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="vol-date">Data *</label>
        <input 
          type="date" 
          id="vol-date" 
          formControlName="date"
          class="form-input"
        />
        <span class="error-message" *ngIf="volunteerForm.get('date')?.invalid && volunteerForm.get('date')?.touched">
          Data √© obrigat√≥ria
        </span>
      </div>

      <div class="form-group">
        <label for="vol-time">Hor√°rio *</label>
        <input 
          type="text" 
          id="vol-time" 
          formControlName="time"
          placeholder="Ex: 09:00 - 13:00"
          class="form-input"
        />
        <span class="error-message" *ngIf="volunteerForm.get('time')?.invalid && volunteerForm.get('time')?.touched">
          Hor√°rio √© obrigat√≥rio
        </span>
      </div>
    </div>

    <div class="form-group">
      <label for="vol-location">Local *</label>
      <input 
        type="text" 
        id="vol-location" 
        formControlName="location"
        placeholder="Ex: Centro - S√£o Paulo, SP"
        class="form-input"
      />
      <span class="error-message" *ngIf="volunteerForm.get('location')?.invalid && volunteerForm.get('location')?.touched">
        Local √© obrigat√≥rio
      </span>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="vol-vacancies">N√∫mero de Vagas *</label>
        <input 
          type="number" 
          id="vol-vacancies" 
          formControlName="vacancies"
          min="1"
          class="form-input"
        />
        <span class="error-message" *ngIf="volunteerForm.get('vacancies')?.invalid && volunteerForm.get('vacancies')?.touched">
          Deve ter pelo menos 1 vaga
        </span>
      </div>

      <div class="form-group">
        <label for="vol-category">Categoria *</label>
        <select 
          id="vol-category" 
          formControlName="category"
          class="form-input"
        >
          <option value="">Selecione uma categoria</option>
          <option *ngFor="let cat of volunteerCategories" [value]="cat">{{ cat }}</option>
        </select>
        <span class="error-message" *ngIf="volunteerForm.get('category')?.invalid && volunteerForm.get('category')?.touched">
          Selecione uma categoria
        </span>
      </div>
    </div>

    <div class="form-group">
      <label for="vol-skills">Habilidades Desejadas (opcional)</label>
      <input 
        type="text" 
        id="vol-skills" 
        formControlName="skills"
        placeholder="Ex: Comunica√ß√£o, Trabalho em equipe, Paci√™ncia (separe por v√≠rgula)"
        class="form-input"
      />
      <small class="form-hint">Separe as habilidades por v√≠rgula</small>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" (click)="closeVolunteerModal()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="volunteerForm.invalid">
        {{ editingOpportunity ? 'Salvar Altera√ß√µes' : 'Criar Oportunidade' }}
      </button>
    </div>
  </form>
</app-modal>

<!-- Modal de Visualiza√ß√£o de Inscritos -->
<app-modal 
  [isOpen]="isRegistrationsModalOpen" 
  [title]="'Volunt√°rios Inscritos - ' + selectedOpportunityTitle"
  size="medium"
  (close)="closeRegistrationsModal()">
  
  <div class="registrations-list" *ngIf="selectedOpportunityRegistrations.length > 0">
    <div class="registration-item" *ngFor="let reg of selectedOpportunityRegistrations">
      <div class="registration-header">
        <div class="volunteer-avatar-large">{{ reg.volunteerName.charAt(0) }}</div>
        <div class="volunteer-details">
          <h4>{{ reg.volunteerName }}</h4>
          <p>üìß {{ reg.volunteerEmail }}</p>
          <p>üì± {{ reg.phone }}</p>
        </div>
        <span class="status-badge" [ngClass]="'status-' + reg.status">
          {{ reg.status === 'confirmed' ? '‚úÖ Confirmado' : reg.status === 'pending' ? '‚è≥ Pendente' : '‚ùå Cancelado' }}
        </span>
      </div>
      
      <div class="registration-message" *ngIf="reg.message">
        <strong>Mensagem:</strong>
        <p>{{ reg.message }}</p>
      </div>

      <div class="registration-footer">
        <small>Inscrito em: {{ reg.registeredAt | date:'dd/MM/yyyy HH:mm' }}</small>
        <button 
          *ngIf="reg.status === 'pending'" 
          class="btn-small btn-confirm"
          (click)="confirmRegistration(reg.id)">
          Confirmar
        </button>
      </div>
    </div>
  </div>

  <div class="empty-state" *ngIf="selectedOpportunityRegistrations.length === 0">
    <p>üì≠ Ainda n√£o h√° volunt√°rios inscritos nesta oportunidade.</p>
  </div>
</app-modal>
</div>
