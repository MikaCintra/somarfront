<div class="dashboard-content">
  <!-- Header -->
  <header class="dashboard-header">
    <div>
      <h1>{{ i18n.t('dashboard.donor.welcome') }} üëã</h1>
      <p>{{ i18n.t('dashboard.donor.subtitle') }}</p>
    </div>
    <app-theme-language-toggle></app-theme-language-toggle>
  </header>

  <!-- Gamification Section -->
  <section class="gamification-section" *ngIf="userGamification">
    <div class="gamification-header">
        <div class="level-badge">
          <span class="level-icon">üèÜ</span>
          <div class="level-info">
            <span class="level-label">{{ i18n.t('dashboard.donor.level') }}</span>
            <span class="level-number">{{ userGamification.level }}</span>
          </div>
        </div>
        <div class="points-info">
          <span class="points-label">{{ i18n.t('dashboard.donor.totalPoints') }}</span>
          <span class="points-value">{{ userGamification.points }}</span>
        </div>
        <div class="streak-info">
          <span class="streak-icon">üî•</span>
          <span class="streak-text">{{ userGamification.streakDays }} {{ i18n.t('dashboard.donor.consecutiveDays') }}</span>
        </div>
      </div>
      
      <div class="level-progress">
        <div class="progress-bar-gamification">
          <div class="progress-fill-gamification" [style.width.%]="getLevelProgress()"></div>
        </div>
        <span class="progress-text">{{ getPointsToNextLevel() }} {{ i18n.t('common.pointsToNext') }}</span>
      </div>

      <div class="badges-showcase">
        <h3>üéñÔ∏è {{ i18n.t('dashboard.donor.achievements') }} ({{ getUnlockedBadgesCount() }}/{{ getTotalBadgesCount() }})</h3>
        <div class="badges-grid">
          <div class="badge-item" 
               *ngFor="let item of userBadgesDisplay" 
               [class.unlocked]="item.achievement"
               [class.locked]="!item.achievement"
               [title]="item.badge.description">
            <span class="badge-icon">{{ item.badge.icon }}</span>
            <span class="badge-name">{{ item.badge.name }}</span>
            <span class="badge-type" [class]="'badge-' + item.badge.type">{{ item.badge.type }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Impact Stats -->
    <section class="impact-stats">
      <div class="impact-card">
        <div class="impact-icon">üíù</div>
        <div class="impact-info">
          <h3>{{ i18n.t('dashboard.donor.donationsMade') }}</h3>
          <p class="impact-value">{{ myContributions.donations }}</p>
        </div>
      </div>
      <div class="impact-card">
        <div class="impact-icon">‚è±Ô∏è</div>
        <div class="impact-info">
          <h3>{{ i18n.t('dashboard.ong.volunteerHours') }}</h3>
          <p class="impact-value">{{ myContributions.volunteerHours }}h</p>
        </div>
      </div>
      <div class="impact-card">
        <div class="impact-icon">‚ù§Ô∏è</div>
        <div class="impact-info">
          <h3>{{ i18n.t('dashboard.donor.impactedPeople') }}</h3>
          <p class="impact-value">{{ myContributions.impactedPeople }}+</p>
        </div>
      </div>
    </section>

    <!-- Featured Campaigns -->
    <section class="section">
      <div class="section-header">
        <h2>{{ i18n.t('dashboard.donor.availableCampaigns') }}</h2>
      </div>

      <!-- Filtros -->
      <div class="filters-container">
        <div class="filter-group">
          <label>üîç {{ i18n.t('common.search') }}</label>
          <input 
            type="text" 
            [(ngModel)]="searchQuery"
            (input)="applyFilters()"
            [placeholder]="i18n.t('dashboard.donor.searchPlaceholder')"
            class="filter-input"
          />
        </div>

        <div class="filter-group">
          <label>üìÇ {{ i18n.t('campaign.category') }}</label>
          <select 
            [(ngModel)]="selectedCategory"
            (change)="applyFilters()"
            class="filter-select"
          >
            <option value="">{{ i18n.t('common.all') }}</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ i18n.translateCategory(cat) }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>üìç {{ i18n.t('common.state') }}</label>
          <select 
            [(ngModel)]="selectedState"
            (change)="onStateChange()"
            class="filter-select"
          >
            <option value="">{{ i18n.t('common.allStates') }}</option>
            <option *ngFor="let state of states" [value]="state.uf">{{ state.name }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>üèôÔ∏è {{ i18n.t('common.city') }}</label>
          <select 
            [(ngModel)]="selectedCity"
            (change)="applyFilters()"
            class="filter-select"
            [disabled]="!selectedState"
          >
            <option value="">{{ i18n.t('common.allCities') }}</option>
            <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>‚ö° {{ i18n.t('campaign.urgency') }}</label>
          <select 
            [(ngModel)]="selectedUrgency"
            (change)="applyFilters()"
            class="filter-select"
          >
            <option value="">{{ i18n.t('common.all') }}</option>
            <option value="high">{{ i18n.translateUrgency('high') }}</option>
            <option value="medium">{{ i18n.translateUrgency('medium') }}</option>
            <option value="low">{{ i18n.translateUrgency('low') }}</option>
          </select>
        </div>

        <button class="btn-clear-filters" (click)="clearFilters()">{{ i18n.t('common.clearFilters') }}</button>
      </div>

      <p class="results-count">{{ filteredCampaigns.length }} {{ i18n.t('common.results') }}</p>

      <div class="campaigns-grid">
        <div class="campaign-card" *ngFor="let campaign of filteredCampaigns">
          <div class="campaign-badge" [style.background-color]="getUrgencyColor(campaign.urgency)">
            {{ i18n.translateUrgency(campaign.urgency || 'low') }}
          </div>
          <div class="campaign-ong">{{ campaign.ongName }}</div>
          <h3>{{ campaign.title }}</h3>
          <p class="campaign-description">{{ campaign.description }}</p>
          
          <!-- Rating Section -->
          <div class="campaign-rating">
            <div class="rating-stars">
              <span class="star" *ngFor="let star of [1,2,3,4,5]" 
                    [class.filled]="star <= getCampaignRating(campaign.id)">
                ‚≠ê
              </span>
            </div>
            <span class="rating-text">
              {{ getCampaignRating(campaign.id) | number:'1.1-1' }} 
              ({{ getCampaignReviewCount(campaign.id) }} {{ i18n.t('common.reviews') }})
            </span>
          </div>

          <div class="campaign-meta">
            <span class="meta-item">üìç {{ campaign.location }}</span>
            <span class="meta-item">üè∑Ô∏è {{ i18n.translateCategory(campaign.category) }}</span>
          </div>
          <div class="campaign-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getProgress(campaign)"></div>
            </div>
            <div class="progress-info">
              <span>{{ campaign.current }} / {{ campaign.goal }} {{ i18n.t('common.items') }}</span>
              <span class="progress-percent">{{ getProgress(campaign) | number:'1.0-0' }}%</span>
            </div>
          </div>
          <div class="campaign-actions">
            <button class="btn-details" (click)="openDetailsModal(campaign)">üìã {{ i18n.t('common.viewDetails') }}</button>
            <button class="btn-donate" (click)="openDonationModal(campaign)">üíù {{ i18n.t('common.wantToDonate') }}</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Volunteer Opportunities -->
    <section class="section">
      <div class="section-header">
        <h2>{{ i18n.t('dashboard.donor.volunteerOpportunities') }}</h2>
      </div>
      <div class="opportunities-list">
        <div class="opportunity-card" *ngFor="let opp of volunteerOpportunities; let i = index">
          <div class="opp-icon">üåü</div>
          <div class="opp-content">
            <h3>{{ opp.title }}</h3>
            <div class="opp-details">
              <span class="opp-detail">üè¢ {{ opp.ongName }}</span>
              <span class="opp-detail">üìÖ {{ opp.date | date:'dd/MM' }}</span>
              <span class="opp-detail">‚è∞ {{ opp.time }}</span>
              <span class="opp-detail">üìç {{ opp.location }}</span>
              <span class="opp-detail">üë• {{ getAvailableSpots(opp) }} {{ i18n.t('common.spots') }}</span>
            </div>
          </div>
          <button class="btn-volunteer" (click)="volunteer(i)">{{ i18n.t('common.wantToParticipate') }}</button>
        </div>
      </div>
    </section>

<!-- Modal de Doa√ß√£o -->
<app-modal 
  [isOpen]="isDonationModalOpen" 
  [title]="'Fazer Doa√ß√£o - ' + (selectedCampaign?.title || '')"
  size="medium"
  (close)="closeDonationModal()">
  
  <div class="donation-info" *ngIf="selectedCampaign">
    <p><strong>ONG:</strong> {{ selectedCampaign.ongName }}</p>
    <p><strong>Categoria:</strong> {{ selectedCampaign.category }}</p>
    <p><strong>Localiza√ß√£o:</strong> {{ selectedCampaign.location }}</p>
  </div>

  <form [formGroup]="donationForm" (ngSubmit)="submitDonation()">
    <div class="form-group">
      <label for="itemDescription">O que voc√™ vai doar? *</label>
      <input 
        type="text" 
        id="itemDescription" 
        formControlName="itemDescription"
        placeholder="Ex: Roupas de inverno, Alimentos, Livros..."
        class="form-input"
      />
      <span class="error-message" *ngIf="donationForm.get('itemDescription')?.invalid && donationForm.get('itemDescription')?.touched">
        Descri√ß√£o do item √© obrigat√≥ria
      </span>
    </div>

    <div class="form-group">
      <label for="quantity">Quantidade *</label>
      <input 
        type="number" 
        id="quantity" 
        formControlName="quantity"
        min="1"
        class="form-input"
      />
      <span class="error-message" *ngIf="donationForm.get('quantity')?.invalid && donationForm.get('quantity')?.touched">
        Quantidade deve ser maior que 0
      </span>
    </div>

    <div class="form-group">
      <label for="deliveryType">Tipo de Entrega *</label>
      <select 
        id="deliveryType" 
        formControlName="deliveryType"
        class="form-input"
      >
        <option value="retirada">üöó A ONG retirar√° no meu endere√ßo</option>
        <option value="entrega">üì¶ Eu entregarei no endere√ßo da ONG</option>
      </select>
      <span class="error-message" *ngIf="donationForm.get('deliveryType')?.invalid && donationForm.get('deliveryType')?.touched">
        Selecione o tipo de entrega
      </span>
    </div>

    <div class="form-group">
      <label for="donorName">Seu Nome *</label>
      <input 
        type="text" 
        id="donorName" 
        formControlName="donorName"
        placeholder="Seu nome completo"
        class="form-input"
      />
      <span class="error-message" *ngIf="donationForm.get('donorName')?.invalid && donationForm.get('donorName')?.touched">
        Nome √© obrigat√≥rio
      </span>
    </div>

    <div class="form-group">
      <label for="phone">Telefone para Contato *</label>
      <input 
        type="tel" 
        id="phone" 
        formControlName="phone"
        placeholder="(11) 99999-9999"
        class="form-input"
      />
      <span class="error-message" *ngIf="donationForm.get('phone')?.invalid && donationForm.get('phone')?.touched">
        Telefone √© obrigat√≥rio
      </span>
    </div>

    <div class="form-group">
      <label for="address">{{ donationForm.get('deliveryType')?.value === 'entrega' ? 'Seu Endere√ßo para Refer√™ncia' : 'Endere√ßo para Coleta' }} *</label>
      <textarea 
        id="address" 
        formControlName="address"
        rows="2"
        [placeholder]="donationForm.get('deliveryType')?.value === 'entrega' ? 'Seu endere√ßo (opcional para contato)' : 'Rua, n√∫mero, bairro, cidade'"
        class="form-input"
      ></textarea>
      <span class="error-message" *ngIf="donationForm.get('address')?.invalid && donationForm.get('address')?.touched">
        Endere√ßo √© obrigat√≥rio
      </span>
    </div>

    <div class="form-group">
      <label for="notes">Observa√ß√µes (opcional)</label>
      <textarea 
        id="notes" 
        formControlName="notes"
        rows="2"
        placeholder="Informa√ß√µes adicionais sobre a doa√ß√£o..."
        class="form-input"
      ></textarea>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" (click)="closeDonationModal()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="donationForm.invalid">
        Confirmar Doa√ß√£o
      </button>
    </div>
  </form>
</app-modal>

<!-- Modal de Inscri√ß√£o em Voluntariado -->
<app-modal 
  [isOpen]="isVolunteerRegistrationModalOpen" 
  [title]="'Inscrever-se como Volunt√°rio - ' + (selectedOpportunity?.title || '')"
  size="medium"
  (close)="closeVolunteerRegistrationModal()">
  
  <div class="volunteer-info" *ngIf="selectedOpportunity">
    <h4>Detalhes da Oportunidade:</h4>
    <p><strong>ONG:</strong> {{ selectedOpportunity.ongName }}</p>
    <p><strong>Data:</strong> {{ selectedOpportunity.date | date:'dd/MM/yyyy' }}</p>
    <p><strong>Hor√°rio:</strong> {{ selectedOpportunity.time }}</p>
    <p><strong>Local:</strong> {{ selectedOpportunity.location }}</p>
    <p><strong>Vagas Dispon√≠veis:</strong> {{ getAvailableSpots(selectedOpportunity) }}</p>
    
    <div class="skills-required" *ngIf="selectedOpportunity.skills && selectedOpportunity.skills.length > 0">
      <strong>Habilidades Desejadas:</strong>
      <div class="skills-tags">
        <span class="skill-tag" *ngFor="let skill of selectedOpportunity.skills">{{ skill }}</span>
      </div>
    </div>
  </div>

  <form [formGroup]="volunteerRegistrationForm" (ngSubmit)="submitVolunteerRegistration()">
    <div class="form-group">
      <label for="vol-name">Seu Nome Completo *</label>
      <input 
        type="text" 
        id="vol-name" 
        formControlName="name"
        placeholder="Nome completo"
        class="form-input"
      />
      <span class="error-message" *ngIf="volunteerRegistrationForm.get('name')?.invalid && volunteerRegistrationForm.get('name')?.touched">
        Nome √© obrigat√≥rio
      </span>
    </div>

    <div class="form-group">
      <label for="vol-phone">Telefone para Contato *</label>
      <input 
        type="tel" 
        id="vol-phone" 
        formControlName="phone"
        placeholder="(11) 99999-9999"
        class="form-input"
      />
      <span class="error-message" *ngIf="volunteerRegistrationForm.get('phone')?.invalid && volunteerRegistrationForm.get('phone')?.touched">
        Telefone √© obrigat√≥rio
      </span>
    </div>

    <div class="form-group">
      <label for="vol-message">Mensagem (opcional)</label>
      <textarea 
        id="vol-message" 
        formControlName="message"
        rows="3"
        placeholder="Conte um pouco sobre sua motiva√ß√£o para participar ou experi√™ncias relevantes..."
        class="form-input"
      ></textarea>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" (click)="closeVolunteerRegistrationModal()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="volunteerRegistrationForm.invalid">
        Confirmar Inscri√ß√£o
      </button>
    </div>
  </form>
</app-modal>

<!-- Modal de Detalhes da Campanha -->
<app-campaign-details-modal
  [campaign]="selectedCampaign"
  [isOpen]="isDetailsModalOpen"
  (close)="closeDetailsModal()"
></app-campaign-details-modal>
</div>
